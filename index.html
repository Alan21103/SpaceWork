<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interstellar Mission - Space Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.js"></script>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background: #02050f; 
            cursor: crosshair;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }
        
        /* UI Glassmorphism Layer */
        #ui-container {
            position: absolute;
            top: 25px;
            left: 25px;
            z-index: 10;
            pointer-events: none;
        }
        
        #question-panel {
            position: fixed;
            top: 50%;
            left: 20%;
            transform: translate(-50%, -50%);
            z-index: 100;
            pointer-events: all;
            display: none;
            animation: slideInLeft 0.5s ease-out;
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translate(-100%, -50%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .glass-panel {
            background: rgba(10, 10, 30, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            color: white;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
        }

        h2 { 
            margin: 0; 
            font-size: 14px; 
            letter-spacing: 2px; 
            color: #00d4ff; 
            text-transform: uppercase; 
        }
        
        #planet-name { 
            margin: 5px 0; 
            font-size: 32px; 
            font-weight: bold; 
            text-shadow: 0 0 15px currentColor;
            background: linear-gradient(45deg, #00d4ff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        #score-display { 
            font-size: 18px; 
            margin-top: 10px; 
            opacity: 0.8; 
        }
        
        .option-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-family: inherit;
        }
        
        .option-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.2);
            border-color: #00d4ff;
            transform: translateX(5px);
        }
        
        .option-btn.correct {
            background: rgba(0, 255, 100, 0.3);
            border-color: #00ff64;
            animation: pulse 0.5s ease;
        }
        
        .option-btn.wrong {
            background: rgba(255, 0, 0, 0.3);
            border-color: #ff0040;
            animation: shake 0.5s ease;
        }
        
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        #instruction {
            position: absolute;
            bottom: 30px;
            width: 100%;
            text-align: center;
            color: rgba(255,255,255,0.6);
            letter-spacing: 1px;
            text-transform: uppercase;
            font-size: 12px;
            pointer-events: none;
            animation: fadeInOut 3s ease-in-out infinite;
        }
        
        @keyframes fadeInOut {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 0.8; }
        }
        
        #question-text {
            font-size: 18px;
            margin-bottom: 20px;
            line-height: 1.6;
            color: #fff;
        }
        
        #feedback {
            margin-top: 15px;
            font-size: 16px;
            font-weight: bold;
            min-height: 24px;
            text-align: center;
        }
        
        .question-container {
            width: 450px;
            max-width: 90vw;
        }
        
        /* Planet Info Panel di kanan */
        #planet-info-panel {
            position: fixed;
            top: 50%;
            right: 5%;
            transform: translateY(-50%);
            z-index: 100;
            pointer-events: none;
            display: none;
            animation: slideInRight 0.5s ease-out;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translate(100%, -50%);
            }
            to {
                opacity: 1;
                transform: translateY(-50%);
            }
        }
        
        .planet-info-box {
            background: rgba(10, 10, 30, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            color: white;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
            width: 350px;
            max-width: 90vw;
        }
        
        .planet-fact {
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .planet-fact:last-child {
            border-bottom: none;
        }
        
        .planet-fact::before {
            content: "‚òÖ ";
            color: #00d4ff;
            margin-right: 8px;
        }
        
        #planet-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #00d4ff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        #options-container {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div id="ui-container">
        <div class="glass-panel">
            <h2>Level <span id="level-num">1</span></h2>
            <div id="planet-name">EKSPLORASI ANGKASA</div>
            <div id="score-display">SKOR: <span id="score">0</span></div>
        </div>
    </div>
    
    <!-- Question Panel di Kiri -->
    <div id="question-panel">
        <div class="glass-panel question-container">
            <h2 style="font-size: 18px; margin-bottom: 15px;">ü™ê IDENTIFIKASI PLANET</h2>
            <div id="question-text"></div>
            <div id="options-container"></div>
            <div id="feedback"></div>
        </div>
    </div>
    
    <!-- Planet Info Panel di Kanan -->
    <div id="planet-info-panel">
        <div class="planet-info-box">
            <div id="planet-title">PLANET</div>
            <div style="font-size: 12px; color: #00d4ff; margin-bottom: 15px; letter-spacing: 1px;">FAKTA MENARIK:</div>
            <div id="planet-facts"></div>
        </div>
    </div>
    
    <div id="instruction">üñ±Ô∏è Klik pada planet untuk mempelajarinya!</div>
    
    <script>
let isVR = false;
let angle = 0;
let stars = [];
let galaxies = [];
let galaxyRotation = 0;
let planets = [];
let selectedPlanet = null;
let isZooming = false;
let zoomProgress = 0;
let targetZoom = 1;
let cameraOffset = { x: 0, y: 0, z: 0 };
let targetCameraOffset = { x: 0, y: 0, z: 0 };

// Game variables
let gameState = 'exploring';
let currentLevel = 1;
let score = 0;
let questionsAnswered = 0;
let correctAnswers = 0;

// Textures for planets
let planetTextures = {};
let texturesLoaded = false;

// Planet data dengan informasi edukatif
let planetData = [
  {
    name: 'Merkurius',
    color: {r: 180, g: 140, b: 100},
    textureURL: null, // Akan menggunakan procedural texture
    facts: [
      'Planet terdekat dengan Matahari',
      'Tidak memiliki atmosfer',
      'Suhu siang hari bisa mencapai 430¬∞C',
      'Planet terkecil di tata surya'
    ],
    questions: [
      {
        q: 'Planet manakah yang terdekat dengan Matahari?',
        options: ['Venus', 'Merkurius', 'Bumi', 'Mars'],
        correct: 1
      },
      {
        q: 'Berapa perkiraan suhu siang hari di Merkurius?',
        options: ['100¬∞C', '250¬∞C', '430¬∞C', '600¬∞C'],
        correct: 2
      }
    ]
  },
  {
    name: 'Venus',
    color: {r: 255, g: 200, b: 100},
    textureURL: null,
    facts: [
      'Planet terpanas di tata surya',
      'Berotasi berlawanan arah',
      'Atmosfer sangat tebal dengan CO2',
      'Disebut juga Bintang Kejora'
    ],
    questions: [
      {
        q: 'Planet manakah yang terpanas di tata surya?',
        options: ['Merkurius', 'Venus', 'Mars', 'Bumi'],
        correct: 1
      },
      {
        q: 'Apa kandungan utama atmosfer Venus?',
        options: ['Oksigen', 'Nitrogen', 'CO2', 'Helium'],
        correct: 2
      }
    ]
  },
  {
    name: 'Bumi',
    color: {r: 100, g: 150, b: 255},
    textureURL: null,
    facts: [
      'Satu-satunya planet dengan kehidupan',
      '71% permukaannya adalah air',
      'Memiliki 1 satelit alami (Bulan)',
      'Atmosfer mengandung 21% oksigen'
    ],
    questions: [
      {
        q: 'Berapa persen permukaan Bumi yang tertutup air?',
        options: ['50%', '60%', '71%', '85%'],
        correct: 2
      },
      {
        q: 'Berapa jumlah satelit alami yang dimiliki Bumi?',
        options: ['0', '1', '2', '3'],
        correct: 1
      }
    ]
  },
  {
    name: 'Mars',
    color: {r: 255, g: 100, b: 80},
    textureURL: null,
    facts: [
      'Disebut Planet Merah',
      'Memiliki gunung tertinggi di tata surya (Olympus Mons)',
      'Memiliki 2 bulan: Phobos dan Deimos',
      'Atmosfer sangat tipis'
    ],
    questions: [
      {
        q: 'Mengapa Mars disebut Planet Merah?',
        options: ['Karena panas', 'Karena oksida besi', 'Karena lava', 'Karena atmosfer'],
        correct: 1
      },
      {
        q: 'Berapa jumlah satelit alami Mars?',
        options: ['0', '1', '2', '4'],
        correct: 2
      }
    ]
  },
  {
    name: 'Jupiter',
    color: {r: 220, g: 180, b: 140},
    textureURL: 'jupiter.jpg', 
    facts: [
      'Planet terbesar di tata surya',
      'Memiliki Bintik Merah Besar (badai raksasa)',
      'Memiliki lebih dari 79 bulan',
      'Terdiri dari gas (tidak punya permukaan padat)'
    ],
    questions: [
      {
        q: 'Planet manakah yang terbesar di tata surya?',
        options: ['Saturnus', 'Jupiter', 'Uranus', 'Neptunus'],
        correct: 1
      },
      {
        q: 'Apa yang dimaksud dengan Bintik Merah Besar di Jupiter?',
        options: ['Gunung', 'Badai raksasa', 'Kawah', 'Danau'],
        correct: 1
      }
    ]
  },
  {
    name: 'Saturnus',
    color: {r: 230, g: 210, b: 160},
    textureURL: null,
    facts: [
      'Terkenal dengan cincin indahnya',
      'Planet kedua terbesar',
      'Memiliki lebih dari 80 bulan',
      'Density-nya lebih rendah dari air'
    ],
    questions: [
      {
        q: 'Apa yang membuat Saturnus istimewa?',
        options: ['Warnanya', 'Cincinnya', 'Ukurannya', 'Suhunya'],
        correct: 1
      },
      {
        q: 'Apakah Saturnus bisa mengapung di air?',
        options: ['Ya, karena density-nya rendah', 'Tidak', 'Hanya setengahnya', 'Tergantung suhu'],
        correct: 0
      }
    ]
  },
  {
    name: 'Uranus',
    color: {r: 150, g: 230, b: 230},
    textureURL: null,
    facts: [
      'Berotasi miring (hampir 90 derajat)',
      'Berwarna biru karena metana',
      'Planet terdingin di tata surya',
      'Memiliki 27 bulan yang diketahui'
    ],
    questions: [
      {
        q: 'Mengapa Uranus berwarna biru?',
        options: ['Karena air', 'Karena metana', 'Karena es', 'Karena gas nitrogen'],
        correct: 1
      },
      {
        q: 'Apa yang unik dari rotasi Uranus?',
        options: ['Sangat cepat', 'Miring hampir 90¬∞', 'Berlawanan arah', 'Tidak berotasi'],
        correct: 1
      }
    ]
  },
  {
    name: 'Neptunus',
    color: {r: 100, g: 120, b: 255},
    textureURL: null,
    facts: [
      'Planet terjauh dari Matahari',
      'Memiliki angin terkencang (2000 km/jam)',
      'Berwarna biru tua',
      'Memiliki 14 bulan yang diketahui'
    ],
    questions: [
      {
        q: 'Planet manakah yang terjauh dari Matahari?',
        options: ['Uranus', 'Neptunus', 'Pluto', 'Saturnus'],
        correct: 1
      },
      {
        q: 'Berapa kecepatan angin di Neptunus?',
        options: ['500 km/jam', '1000 km/jam', '2000 km/jam', '3000 km/jam'],
        correct: 2
      }
    ]
  }
];

function preload() {
  // Load planet textures jika ada
  // Untuk menambahkan texture, ganti textureURL dengan path gambar Anda
  // Contoh: textureURL: 'textures/earth.jpg'
  planetData.forEach(data => {
    if (data.textureURL) {
      planetTextures[data.name] = loadImage(data.textureURL, 
        () => console.log(`‚úì Loaded: ${data.name}`),
        () => {
          console.log(`‚úó Failed: ${data.name}, using procedural texture`);
          planetTextures[data.name] = null;
        }
      );
    }
  });
}

function setup() {
  if (typeof createVRCanvas === 'function') {
    createVRCanvas();
    isVR = true;
  } else {
    createCanvas(windowWidth, windowHeight, WEBGL);
    isVR = false;
  }

  // Membuat data bintang acak
  for (let i = 0; i < 400; i++) {
    stars.push({
      x: random(-2000, 2000),
      y: random(-2000, 2000),
      z: random(-2000, 2000),
      size: random(1, 3)
    });
  }
  
  // Membuat galaksi spiral
  for (let g = 0; g < 3; g++) {
    let galaxy = {
      x: random(-3000, 3000),
      y: random(-3000, 3000),
      z: random(-4000, -2000),
      rotation: random(TWO_PI),
      speed: random(0.001, 0.003),
      size: random(300, 600),
      particles: []
    };
    
    for (let i = 0; i < 150; i++) {
      let spiralAngle = i * 0.3;
      let radius = i * 2;
      let armOffset = random(-30, 30);
      
      galaxy.particles.push({
        angle: spiralAngle,
        radius: radius,
        offset: armOffset,
        brightness: random(100, 255),
        size: random(1, 3)
      });
    }
    
    galaxies.push(galaxy);
  }
  
  // Membuat planet sesuai level
  initializePlanets();
  noStroke();
  updateUI();
}

function initializePlanets() {
  planets = [];
  let numPlanets = min(3 + currentLevel, 8);
  
  for (let i = 0; i < numPlanets; i++) {
    let data = planetData[i];
    let angle = (i / numPlanets) * TWO_PI;
    let radius = 250;
    
    planets.push({
      x: cos(angle) * radius,
      y: sin(angle) * radius,
      z: 0,
      radius: random(40, 70),
      color: data.color,
      rotation: random(TWO_PI),
      rotationSpeed: random(0.005, 0.02),
      orbitAngle: random(TWO_PI),
      orbitSpeed: random(0.002, 0.005),
      orbitRadius: random(20, 50),
      data: data,
      hasBeenAsked: false
    });
  }
}

function draw() {
  background(5, 5, 15);

  if (isZooming) {
    zoomProgress = lerp(zoomProgress, 1, 0.08);
    if (zoomProgress > 0.95) {
      zoomProgress = 1;
      if (gameState === 'zooming') {
        gameState = 'questioning';
        showQuestion();
      }
    }
  } else {
    zoomProgress = lerp(zoomProgress, 0, 0.08);
  }

  cameraOffset.x = lerp(cameraOffset.x, targetCameraOffset.x, 0.1);
  cameraOffset.y = lerp(cameraOffset.y, targetCameraOffset.y, 0.1);
  cameraOffset.z = lerp(cameraOffset.z, targetCameraOffset.z, 0.1);

  if (selectedPlanet) {
    let zoomAmount = easeInOutCubic(zoomProgress);
    
    // Posisikan kamera ke kanan agar planet terlihat di sisi kanan layar
    let offsetX = width * 0.25; // Geser ke kanan
    
    camera(
      lerp(0, -selectedPlanet.x + offsetX, zoomAmount) + cameraOffset.x,
      lerp(0, -selectedPlanet.y, zoomAmount) + cameraOffset.y,
      lerp(800, 250, zoomAmount) + cameraOffset.z,
      lerp(0, selectedPlanet.x + offsetX, zoomAmount),
      lerp(0, selectedPlanet.y, zoomAmount),
      0,
      0, 1, 0
    );
  }

  push();
  for (let s of stars) {
    fill(255, random(150, 255));
    push();
    translate(s.x, s.y, s.z);
    sphere(isVR ? s.size * 0.005 : s.size);
    pop();
  }
  pop();

  galaxyRotation += 0.001;
  
  for (let galaxy of galaxies) {
    galaxy.rotation += galaxy.speed;
    
    push();
    translate(galaxy.x, galaxy.y, galaxy.z);
    rotateZ(galaxyRotation * 0.5);
    
    push();
    fill(255, 200, 255, 100);
    noStroke();
    sphere(isVR ? 0.02 : 20);
    fill(255, 150, 255, 50);
    sphere(isVR ? 0.04 : 40);
    pop();
    
    for (let p of galaxy.particles) {
      let totalAngle = p.angle + galaxy.rotation;
      
      for (let arm = 0; arm < 3; arm++) {
        let armAngle = totalAngle + (arm * TWO_PI / 3);
        let x = cos(armAngle) * p.radius;
        let y = sin(armAngle) * p.radius;
        let z = sin(p.angle * 0.5) * 20 + p.offset;
        
        push();
        translate(x, y, z);
        
        let colorMix = map(p.radius, 0, galaxy.size, 0, 1);
        let r = lerp(255, 100, colorMix);
        let g = lerp(150, 150, colorMix);
        let b = lerp(255, 255, colorMix);
        
        fill(r, g, b, p.brightness * 0.6);
        noStroke();
        sphere(isVR ? p.size * 0.002 : p.size);
        pop();
      }
    }
    pop();
  }

  ambientLight(40, 40, 60);
  pointLight(255, 0, 150, 200, 200, 200);
  pointLight(0, 255, 255, -200, -200, 200);
  
  for (let planet of planets) {
    pointLight(planet.color.r, planet.color.g, planet.color.b, planet.x, planet.y, planet.z);
  }

  for (let i = 0; i < planets.length; i++) {
    let planet = planets[i];
    
    planet.rotation += planet.rotationSpeed;
    planet.orbitAngle += planet.orbitSpeed;
    
    push();
    translate(planet.x, planet.y, planet.z);
    
    if (planet === selectedPlanet && isZooming) {
      push();
      fill(255, 255, 255, 30 + sin(frameCount * 0.1) * 20);
      noStroke();
      sphere(planet.radius * 2.2);
      
      // Tambah ring orbit bercahaya
      push();
      rotateX(PI / 3);
      noFill();
      stroke(255, 255, 255, 100 + sin(frameCount * 0.05) * 50);
      strokeWeight(2);
      circle(0, 0, planet.radius * 3);
      pop();
      
      pop();
    }
    
    push();
    rotateY(planet.orbitAngle);
    translate(planet.orbitRadius, 0, 0);
    fill(255, 255, 255, 200);
    sphere(planet.radius * 0.15);
    pop();
    
    rotateY(planet.rotation);
    rotateX(planet.rotation * 0.5);
    
    // Gunakan texture jika tersedia, jika tidak gunakan procedural texture
    let texture = planetTextures[planet.data.name];
    if (texture && texture.width > 0) {
      // Gunakan texture gambar
      texture(texture);
      noStroke();
      sphere(planet.radius);
    } else {
      // Gunakan procedural texture (warna dengan detail)
      noStroke();
      
      // Base planet dengan gradient
      push();
      ambientMaterial(planet.color.r, planet.color.g, planet.color.b);
      specularMaterial(planet.color.r * 0.7, planet.color.g * 0.7, planet.color.b * 0.7);
      shininess(30);
      sphere(planet.radius);
      pop();
      
      // Tambahkan detail dengan sphere kecil untuk texture effect
      if (planet === selectedPlanet && isZooming) {
        push();
        // Tambahkan beberapa "crater" atau detail
        for (let i = 0; i < 20; i++) {
          let theta = random(TWO_PI);
          let phi = random(PI);
          let r = planet.radius * 1.01;
          
          let x = r * sin(phi) * cos(theta);
          let y = r * sin(phi) * sin(theta);
          let z = r * cos(phi);
          
          push();
          translate(x, y, z);
          fill(planet.color.r * 0.8, planet.color.g * 0.8, planet.color.b * 0.8, 150);
          noStroke();
          sphere(planet.radius * 0.05);
          pop();
        }
        pop();
      }
    }
    
    if (planet.data.name === 'Saturnus' || planet.data.name === 'Uranus') {
      push();
      rotateX(PI / 2);
      noFill();
      stroke(planet.color.r, planet.color.g, planet.color.b, 100);
      strokeWeight(3);
      for (let r = 1.3; r < 1.8; r += 0.1) {
        circle(0, 0, planet.radius * r * 2);
      }
      pop();
    }
    
    noStroke();
    fill(planet.color.r, planet.color.g, planet.color.b, 30);
    sphere(planet.radius * 1.3);
    
    pop();
  }
}

function mousePressed() {
  if (gameState !== 'exploring') return;
  
  for (let planet of planets) {
    let screenPos = getScreenPosition(planet.x, planet.y, planet.z);
    let d = dist(mouseX, mouseY, screenPos.x, screenPos.y);
    
    if (d < planet.radius * 1.5) {
      selectPlanet(planet);
      break;
    }
  }
}

function selectPlanet(planet) {
  selectedPlanet = planet;
  gameState = 'zooming';
  isZooming = true;
  zoomProgress = 0;
  
  document.getElementById('planet-name').textContent = planet.data.name.toUpperCase();
}

function showQuestion() {
  if (!selectedPlanet || selectedPlanet.hasBeenAsked) {
    resetZoom();
    return;
  }
  
  let questions = selectedPlanet.data.questions;
  let question = random(questions);
  
  // Show question panel (kiri)
  let panel = document.getElementById('question-panel');
  let questionText = document.getElementById('question-text');
  let optionsContainer = document.getElementById('options-container');
  let feedback = document.getElementById('feedback');
  
  questionText.textContent = question.q;
  optionsContainer.innerHTML = '';
  feedback.textContent = '';
  
  question.options.forEach((option, index) => {
    let btn = document.createElement('button');
    btn.className = 'option-btn';
    btn.textContent = option;
    btn.onclick = () => checkAnswer(index, question.correct, btn);
    optionsContainer.appendChild(btn);
  });
  
  panel.style.display = 'block';
  
  // Show planet info panel (kanan)
  let infoPanel = document.getElementById('planet-info-panel');
  let planetTitle = document.getElementById('planet-title');
  let planetFacts = document.getElementById('planet-facts');
  
  planetTitle.textContent = selectedPlanet.data.name.toUpperCase();
  planetFacts.innerHTML = '';
  
  selectedPlanet.data.facts.forEach(fact => {
    let factDiv = document.createElement('div');
    factDiv.className = 'planet-fact';
    factDiv.textContent = fact;
    planetFacts.appendChild(factDiv);
  });
  
  infoPanel.style.display = 'block';
  
  gameState = 'answering';
}

function checkAnswer(selected, correct, btn) {
  let buttons = document.querySelectorAll('.option-btn');
  buttons.forEach(b => b.disabled = true);
  
  questionsAnswered++;
  
  if (selected === correct) {
    btn.classList.add('correct');
    document.getElementById('feedback').innerHTML = '‚úì Benar! +10 poin';
    document.getElementById('feedback').style.color = '#00ff64';
    score += 10;
    correctAnswers++;
    selectedPlanet.hasBeenAsked = true;
  } else {
    btn.classList.add('wrong');
    buttons[correct].classList.add('correct');
    document.getElementById('feedback').innerHTML = '‚úó Salah! Jawaban yang benar: ' + buttons[correct].textContent;
    document.getElementById('feedback').style.color = '#ff0040';
  }
  
  updateUI();
  
  setTimeout(() => {
    document.getElementById('question-panel').style.display = 'none';
    document.getElementById('planet-info-panel').style.display = 'none';
    resetZoom();
    checkLevelComplete();
  }, 3000);
}

function resetZoom() {
  isZooming = false;
  gameState = 'exploring';
  selectedPlanet = null;
  targetCameraOffset = { x: 0, y: 0, z: 0 };
}

function checkLevelComplete() {
  let allAsked = planets.every(p => p.hasBeenAsked);
  
  if (allAsked) {
    currentLevel++;
    questionsAnswered = 0;
    
    setTimeout(() => {
      alert(`Level ${currentLevel - 1} Selesai!\nSkor Anda: ${score}\nLanjut ke Level ${currentLevel}!`);
      initializePlanets();
      updateUI();
    }, 500);
  }
}

function updateUI() {
  document.getElementById('level-num').textContent = currentLevel;
  document.getElementById('score').textContent = score;
}

function getScreenPosition(x, y, z) {
  let cam = { x: 0, y: 0, z: 800 };
  
  if (selectedPlanet && isZooming) {
    let zoomAmount = easeInOutCubic(zoomProgress);
    cam.x = lerp(0, -selectedPlanet.x, zoomAmount);
    cam.y = lerp(0, -selectedPlanet.y, zoomAmount);
    cam.z = lerp(800, 300, zoomAmount);
  }
  
  let dx = x - cam.x;
  let dy = y - cam.y;
  let dz = z - cam.z;
  
  let fov = PI / 3;
  let cameraZ = (height / 2) / tan(fov / 2);
  
  let screenX = (dx / -dz) * cameraZ + width / 2;
  let screenY = (dy / -dz) * cameraZ + height / 2;
  
  return { x: screenX, y: screenY };
}

function easeInOutCubic(t) {
  return t < 0.5 ? 4 * t * t * t : 1 - pow(-2 * t + 2, 3) / 2;
}

function windowResized() {
  if (!isVR) resizeCanvas(windowWidth, windowHeight);
}
    </script>
</body>
</html>